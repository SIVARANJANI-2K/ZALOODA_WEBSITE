<!DOCTYPE html>
<html>
  <head>
    <title>Checkout</title>
    <script src="https://www.paypal.com/sdk/js?client-id=Acb2uVhvNz_ALeI5AGjpg0AYxIrcVzOF3k3RtRq1TWBrMYsLek34W7VOiJi8vmTarHv2C1rkthyAEYoc&currency=USD&components=buttons"></script>
  </head>
  <body style="background-color: #111; color: white">
    <h1>Complete your payment</h1>
    <div id="paypal-button-container"></div>
    <div>
      <a href="index.html">Back to Home</a>
    </div>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const totalPrice = urlParams.get("price") || "10.00";

      paypal
        .Buttons({
          // ‚úÖ must include both parameters
          createOrder: async function (data, actions) {
            try {
              const orderId = await actions.order.create({
                purchase_units: [
                  {
                    amount: {
                      currency_code: "USD",
                      value: totalPrice,
                    },
                  },
                ],
              });
              console.log("‚úÖ Order created successfully:", orderId);
              return orderId; // must return ID
            } catch (error) {
              console.error("‚ùå Error creating order:", error);
            }
          },

          // ‚úÖ must include both parameters
          onApprove: async function (data, actions) {
            console.log("üîπ onApprove triggered! Capturing payment...");
            try {
              const details = await actions.order.capture();
              alert
                ("Payment completed successfully by " + details.payer.name.given_name);
              
            } catch (error) {
              console.error("‚ùå Error capturing payment:", error);
              alert("Something went wrong while capturing the payment.");
            }
          },

          onCancel: function () {
            alert("Payment was cancelled by the user.");
          },
        })
        .render("#paypal-button-container");
    </script>
  </body>
</html>
